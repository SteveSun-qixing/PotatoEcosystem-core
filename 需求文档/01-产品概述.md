# 薯片微内核 - 产品概述

**版本**: 1.0.0  
**更新日期**: 2026-01-31  
**状态**: 全新设计

---

## 1.1 产品定位

薯片微内核（Chips Core）是薯片生态的核心枢纽，位于整个架构的最底层。它是一个极简的路由和模块管理平台，专注于实现生态的核心原则：**中心路由架构**。

### 核心定位

- **中心路由枢纽**：所有模块通信的唯一中转站
- **模块生命周期管理器**：负责模块的注册、加载、卸载和依赖解析
- **事件通信总线**：提供事件发布订阅机制
- **配置中心**：提供统一的配置管理
- **日志中心**：提供统一的日志记录

### 架构层级

```
微内核层（Chips-Core 1.0.0）
    ↓ 提供路由服务
公共基础层（Chips-Foundation）
    ↓ 提供基础能力
功能插件层
    ↓ 组合
软件产品层
```

## 1.2 核心价值

### 1.2.1 实现极致模块化

**完全解耦**：
- 所有模块通过内核路由通信，互不依赖
- 模块可以独立开发、测试、发布
- 模块可以随时替换，不影响其他模块

**标准化通信**：
- 统一的请求-响应格式
- 标准化的接口定义
- 一致的错误处理机制

### 1.2.2 确保架构清晰

**强制中心路由**：
- 禁止模块间直接通信
- 所有通信必须经过内核
- 通信过程可监控、可审计

**职责单一**：
- 微内核只负责路由和管理
- 基础功能由 Foundation 提供
- 业务逻辑由功能插件实现

### 1.2.3 支持灵活部署

**两种打包模式**：
- **完全独立模式**：内核+依赖+模块打包成独立软件（~150MB）
- **共享内核模式**：多个软件共享同一内核（每个软件~5MB）

**多种运行方式**：
- 桌面应用
- 命令行工具
- 系统服务
- 嵌入式库

## 1.3 产品边界

### 1.3.1 内核职责（必须做）

**中心路由系统**：
- 接收和验证路由请求
- 维护和查询路由表
- 转发请求到目标模块
- 管理响应返回
- 记录通信日志
- 监控路由性能

**模块管理系统**：
- 模块注册和发现
- 模块加载和卸载
- 依赖关系解析
- 版本兼容性检查
- 模块状态跟踪
- 健康检查和异常恢复

**事件总线**：
- 事件发布
- 事件订阅和取消订阅
- 事件并发分发

**配置管理**：
- 多层级配置加载和合并
- 配置读写
- 配置变更通知

**日志系统**：
- 结构化日志记录
- 日志级别管理
- 日志输出（文件、控制台）
- 日志轮转

### 1.3.2 非内核职责（不应该做）

**不包含具体功能**（由 Foundation 提供）：
- ❌ 文件识别和类型判断
- ❌ 资源管理和缓存
- ❌ ZIP 文件处理
- ❌ 运行时环境（JS/Python/WASM）
- ❌ 窗口管理
- ❌ 媒体处理（视频、音频、图片）
- ❌ 文本处理（Markdown、代码高亮）
- ❌ 网络功能（HTTP、下载）

**不包含业务逻辑**：
- ❌ 卡片编辑功能
- ❌ 卡片渲染显示
- ❌ UI 组件
- ❌ 特定的文件处理逻辑

**不处理用户交互**：
- ❌ 用户界面
- ❌ 用户输入的业务语义
- ❌ 特定的交互逻辑

**不管理业务数据**：
- ❌ 用户卡片内容
- ❌ 用户个人数据
- ❌ 数据同步和备份

### 1.3.3 边界示例

**场景1：用户拖入视频文件**
- ✅ 内核职责：接收文件路径，路由到文件识别模块（Foundation）
- ✅ Foundation 职责：识别文件类型
- ✅ 内核职责：根据文件类型，路由到视频卡片处理模块
- ❌ 非内核职责：解码视频、生成缩略图、提取元数据

**场景2：模块A调用模块B**
- ✅ 内核职责：接收A的请求，验证格式，查找路由，转发给B，接收响应，返回给A
- ❌ 非内核职责：理解请求的业务含义（由模块B处理）

**场景3：插件需要读取卡片内容**
- ✅ 内核职责：接收读取请求，路由到资源管理模块（Foundation）
- ✅ Foundation 职责：通过资源管理系统获取文件数据
- ❌ 非内核职责：解析卡片格式（由具体的卡片插件处理）

## 1.4 技术定位

### 1.4.1 技术栈

**编程语言**：
- 核心路由：Rust（高性能、内存安全）
- 模块接口：提供多语言绑定（JavaScript、Python等）
- 配置和通信：YAML/JSON

**架构模式**：
- 微内核架构
- 事件驱动
- 插件化

### 1.4.2 性能要求

- **启动速度**：冷启动 < 500ms
- **路由延迟**：单次路由 < 10ms (P95)
- **内存占用**：基础内核 < 30MB
- **并发支持**：≥1000 并发请求

### 1.4.3 平台支持

- **操作系统**：Windows 10+, macOS 11+, Linux
- **架构**：x86_64, ARM64

## 1.5 版本信息

### 1.5.1 当前版本

- **内核版本**：1.0.0
- **API 版本**：1.0.0
- **协议版本**：1.0.0

### 1.5.2 版本规则

采用语义化版本规范（Semantic Versioning）：

- **主版本号**：不兼容的 API 变更
- **次版本号**：向后兼容的功能新增
- **修订号**：向后兼容的问题修复

## 1.6 与其他模块的关系

### 1.6.1 依赖关系

**四层架构**：
```
微内核层（Chips-Core 1.0.0）
    ↑ 依赖
    |
公共基础层（Chips-Foundation）
    ↑ 依赖
    |
功能插件层
    ↑ 组合
    |
软件产品层
```

**内核的外部依赖**（最小化）：
- 异步运行时（tokio）
- 序列化库（serde、serde_yaml、serde_json）
- 日志库（tracing）
- 版本解析（semver）
- 配置解析（config-rs）

**不依赖**：
- ❌ ZIP 处理库
- ❌ HTTP 客户端
- ❌ 文件类型检测
- ❌ JavaScript/Python 运行时
- ❌ 窗口管理库
- ❌ 媒体处理库

### 1.6.2 协作关系

**内核与公共基础层**：
- Foundation 作为特殊模块注册到 Core
- Foundation 模块通过 Core 的路由进行通信
- Core 不直接调用 Foundation 的实现
- Core 负责路由，Foundation 提供基础能力

**内核与功能插件**：
- 插件注册到 Core
- 插件通过 Core 的接口实现功能
- 插件间通信完全通过 Core 路由
- 插件需要基础能力时，通过 Core 路由到 Foundation

## 1.7 成功标准

### 1.7.1 技术指标

- ✅ 实现完整的中心路由功能
- ✅ 支持至少10种不同类型的模块
- ✅ 路由延迟 < 10ms (P95)
- ✅ 内存占用 < 30MB
- ✅ 启动时间 < 500ms
- ✅ 内核体积 < 20MB
- ✅ 测试覆盖率 ≥ 80%

### 1.7.2 开发体验指标

- ✅ 提供完整的开发文档
- ✅ 提供至少2种语言的 SDK（Rust、JavaScript）
- ✅ 提供模块开发脚手架
- ✅ 提供调试和日志工具
- ✅ 开发者能在2小时内完成第一个模块开发

### 1.7.3 生态指标

- ✅ 公共基础层（Foundation）完整实现
- ✅ 与公共基础层无缝集成
- ✅ 基于内核和基础层开发出完整的编辑引擎
- ✅ 基于内核和基础层开发出完整的查看器
- ✅ 基于内核和基础层开发出至少10种基础卡片类型
- ✅ 支持打包成独立软件产品
- ✅ 支持共享内核模式运行

## 1.8 设计原则

### 1.8.1 极简原则

**只包含核心功能**：
- 路由、模块管理、事件、配置、日志
- 所有其他功能由模块提供

**轻量化**：
- 内核体积 < 20MB
- 内存占用 < 30MB
- 启动速度 < 500ms

### 1.8.2 中心路由原则

**强制路由**：
- 所有模块间通信必须通过内核
- 禁止模块直接通信
- 所有通信可监控、可审计

**标准化**：
- 统一的请求-响应格式
- 标准的接口定义
- 一致的错误处理

### 1.8.3 模块化原则

**完全解耦**：
- 模块间互不依赖
- 模块可独立开发、测试、发布
- 模块可随时替换

**按需加载**：
- 启动时只加载必需模块
- 其他模块按需动态加载
- 减少启动时间和内存占用

## 1.9 文档说明

本文档是薯片微内核 1.0.0 需求规格说明书的第一部分，主要阐述产品的定位、价值和边界。

**后续文档**：
- **02-功能需求.md**：详细的功能需求列表
- **03-用户故事.md**：开发者使用内核的典型场景

**配套技术文档**（位于`技术文档/`目录）：
- **01-架构设计.md**：整体架构和系统设计
- **02-中心路由系统设计.md**：路由系统的详细设计
- **03-模块管理系统设计.md**：模块管理的详细设计
- **04-事件总线设计.md**：事件系统的详细设计
- **05-与基础层协作.md**：如何与 Foundation 协作
- **06-接口定义.md**：API 和接口规范

**公共基础层文档**：
- `Chips-Foundation/需求文档/`：公共基础层的需求规格
- `Chips-Foundation/技术文档/`：公共基础层的技术文档

---

**文档维护者**：Chips 生态核心团队  
**最后更新**：2026-01-31  
**状态**：✅ 生效
